# GreenSense Project Index
GreenSense makes it possible to monitor gardens and automate irrigation.

## Hardware/Software Setup Guides
Complete hardware and software setup guides for the GreenSense projects are available here:
- [https://sites.google.com/view/greensensenetwork](https://sites.google.com/view/greensensenetwork)

## Automated Tests

|               |               | master | dev |
| ------------- | ------------- | ------------- | ------------- |
| **Index**  |               |               |               |
|               | Travis CI Test  | [![Build Status](https://travis-ci.org/GreenSense/Index.svg?branch=master)](https://travis-ci.org/GreenSense/Index) | [![Build Status](https://travis-ci.org/GreenSense/Index.svg?branch=dev)](https://travis-ci.org/GreenSense/Index) |
|               | Jenkins Hardware Test  | [![Build Status](http://greensense.ddns.net:8080/job/GreenSense/job/Index/job/master/badge/icon)](http:/greensense.ddns.net:8080/job/GreenSense/job/Index/job/master/)  | [![Build Status](http://greensense.ddns.net:8080/job/GreenSense/job/Index/job/dev/badge/icon)](http:/greensense.ddns.net:8080/job/GreenSense/job/Index/job/dev/)  |
| **Monitor**  |               |               |               |
|               | Travis CI Build  | [![Build Status](https://travis-ci.org/GreenSense/SoilMoistureSensorCalibratedSerial.svg?branch=master)](https://travis-ci.org/GreenSense/SoilMoistureSensorCalibratedSerial)  | [![Build Status](https://travis-ci.org/GreenSense/SoilMoistureSensorCalibratedSerial.svg?branch=dev)](https://travis-ci.org/GreenSense/SoilMoistureSensorCalibratedSerial)  |
|               | Jenkins Hardware Test  | [![Build Status](http://greensense.ddns.net:8080/job/GreenSense/job/SoilMoistureSensorCalibratedSerial/job/master/badge/icon)](http:/greensense.ddns.net:8080/job/GreenSense/job/SoilMoistureSensorCalibratedSerial/job/master/)  | [![Build Status](http://greensense.ddns.net:8080/job/GreenSense/job/SoilMoistureSensorCalibratedSerial/job/dev/badge/icon)](http:/greensense.ddns.net:8080/job/GreenSense/job/SoilMoistureSensorCalibratedSerial/job/dev/)  |
| **WiFi Monitor**  |               |               |               |
|               | Travis CI Build  | [![Build Status](https://travis-ci.org/GreenSense/SoilMoistureSensorCalibratedSerialESP.svg?branch=master)](https://travis-ci.org/GreenSense/SoilMoistureSensorCalibratedSerialESP)  | [![Build Status](https://travis-ci.org/GreenSense/SoilMoistureSensorCalibratedSerialESP.svg?branch=dev)](https://travis-ci.org/GreenSense/SoilMoistureSensorCalibratedSerialESP)  |
|               | Jenkins Hardware Test  | [![Build Status](http://greensense.ddns.net:8080/job/GreenSense/job/SoilMoistureSensorCalibratedSerialESP/job/master/badge/icon)](http:/greensense.ddns.net:8080/job/GreenSense/job/SoilMoistureSensorCalibratedSerialESP/job/master/)  | [![Build Status](http://greensense.ddns.net:8080/job/GreenSense/job/SoilMoistureSensorCalibratedSerialESP/job/dev/badge/icon)](http:/greensense.ddns.net:8080/job/GreenSense/job/SoilMoistureSensorCalibratedSerialESP/job/dev/)  |
| **Irrigator**  |               |               |               |
|               | Travis CI Build  | [![Build Status](https://travis-ci.org/GreenSense/SoilMoistureSensorCalibratedPump.svg?branch=master)](https://travis-ci.org/GreenSense/SoilMoistureSensorCalibratedPump)  | [![Build Status](https://travis-ci.org/GreenSense/SoilMoistureSensorCalibratedPump.svg?branch=dev)](https://travis-ci.org/GreenSense/SoilMoistureSensorCalibratedPump)  |
|               | Jenkins Hardware Test  | [![Build Status](http://greensense.ddns.net:8080/job/GreenSense/job/SoilMoistureSensorCalibratedPump/job/master/badge/icon)](http:/greensense.ddns.net:8080/job/GreenSense/job/SoilMoistureSensorCalibratedPump/job/master/)  | [![Build Status](http://greensense.ddns.net:8080/job/GreenSense/job/SoilMoistureSensorCalibratedPump/job/dev/badge/icon)](http:/greensense.ddns.net:8080/job/GreenSense/job/SoilMoistureSensorCalibratedPump/job/dev/)  |
| **WiFi Irrigator**  |               |               |               |
|               | Travis CI Build  | [![Build Status](https://travis-ci.org/GreenSense/SoilMoistureSensorCalibratedPumpESP.svg?branch=master)](https://travis-ci.org/GreenSense/SoilMoistureSensorCalibratedPumpESP)  | [![Build Status](https://travis-ci.org/GreenSense/SoilMoistureSensorCalibratedPumpESP.svg?branch=dev)](https://travis-ci.org/GreenSense/SoilMoistureSensorCalibratedPumpESP)  |
|               | Jenkins Hardware Test  | [![Build Status](http://greensense.ddns.net:8080/job/GreenSense/job/SoilMoistureSensorCalibratedPumpESP/job/master/badge/icon)](http:/greensense.ddns.net:8080/job/GreenSense/job/SoilMoistureSensorCalibratedPumpESP/job/master/)  | [![Build Status](http://greensense.ddns.net:8080/job/GreenSense/job/SoilMoistureSensorCalibratedPumpESP/job/dev/badge/icon)](http:/greensense.ddns.net:8080/job/GreenSense/job/SoilMoistureSensorCalibratedPumpESP/job/dev/)  |
| **MQTT Bridge** |               |               |               |
|               | Travis CI Build  | [![Build Status](https://travis-ci.org/CompulsiveCoder/BridgeArduinoSerialToMqttSplitCsv.svg?branch=master)](https://travis-ci.org/CompulsiveCoder/BridgeArduinoSerialToMqttSplitCsv)  | [![Build Status](https://travis-ci.org/CompulsiveCoder/BridgeArduinoSerialToMqttSplitCsv.svg?branch=dev)](https://travis-ci.org/CompulsiveCoder/BridgeArduinoSerialToMqttSplitCsv)  |
| **Updater**  |               |               |               |
|               | Travis CI Build  | [![Build Status](https://travis-ci.org/CompulsiveCoder/GitDeployer.svg?branch=master)](https://travis-ci.org/CompulsiveCoder/GitDeployer)  | [![Build Status](https://travis-ci.org/CompulsiveCoder/GitDeployer.svg?branch=dev)](https://travis-ci.org/CompulsiveCoder/GitDeployer)  |
| **Serial Controller**  |               |               |               |
|               | Travis CI Build  | [![Build Status](https://travis-ci.org/CompulsiveCoder/ArduinoSerialController.svg?branch=master)](https://travis-ci.org/CompulsiveCoder/ArduinoSerialController)  | [![Build Status](https://travis-ci.org/CompulsiveCoder/ArduinoSerialController.svg?branch=dev)](https://travis-ci.org/CompulsiveCoder/ArduinoSerialController)  |
| **Serial Controller Client**  |               |               |               |
|               | Travis CI Build  | [![Build Status](https://travis-ci.org/CompulsiveCoder/ArduinoSerialControllerClient.svg?branch=master)](https://travis-ci.org/CompulsiveCoder/ArduinoSerialControllerClient)  | [![Build Status](https://travis-ci.org/CompulsiveCoder/ArduinoSerialControllerClient.svg?branch=dev)](https://travis-ci.org/CompulsiveCoder/ArduinoSerialControllerClient)  |

## Uptime Monitor
Monitors the GreenSense infrastructure and live test systems.
- [Uptime Robot](https://stats.uptimerobot.com/OPj6DfM61)

# Clone and Setup

## Automatic Clone and Initialize
```
# Prepare the workspace
mkdir ~/workspace
cd ~/workspace

# Clone and Setup
# Use either wget or curl to download and launch the setup process...

# wget
wget -O - https://raw.githubusercontent.com/GreenSense/Index/master/setup-from-github.sh | sh
cd GreenSense/Index

# curl
curl https://raw.githubusercontent.com/GreenSense/Index/master/setup-from-github.sh | sh
cd GreenSense/Index

```
Note: The above script will automatically run the prepare.sh and init.sh scripts so they don't need to be run again.
After it completes, skip past the "Manual Clone and Initialize" section down to the "Set Up Garden" section below.

## Manual Clone and Initialize
### Clone Index with Submodules
```
git clone --recursive git://github.com/GreenSense/Index.git GreenSense/Index

cd GreenSense/Index
```

### Prepare Host Computer
```
sudo sh prepare.sh
```

### Initialize Libraries
```
sh init.sh
```

## Set Up Garden
### Set MQTT Credentials
Set the username and password used by the MQTT broker and MQTT bridge.
```
sh set-mqtt-credentials.sh [Host] [Username] [Password] [Port]

sh set-mqtt-credentials.sh 10.0.0.20 myuser mypass
```
Note: The Port argument is optional and defaults to 1883.

### Set Up Garden Services
Set up the mosquitto MQTT broker.
Note: Set the MQTT credentials above first.
```
sh create-garden.sh
```

### Disable Garden Services
Disable the mosquitto MQTT broker if it needs to be stopped.
```
sh disable-garden.sh
```

### Reset Garden Cache
Removes the MQTT bridge and updater service cache and temporary files. This is useful if a service isn't running properly.
Note: This will force the updater to re-update the connected devices.
```
sh remove-cache.sh
```

## Create and Manage Garden Devices
### Create monitor device
Set up a GreenSense monitor device including MQTT bridge and automatic updater.
Note: Ensure the device is connected

#### Arduino Nano
```
sh create-garden-monitor-nano.sh [DeviceLabel] [DeviceName] [Port]

sh create-garden-monitor-nano.sh Monitor1 monitor1 ttyUSB0
```

#### Arduino Uno
```
sh create-garden-monitor-uno.sh [DeviceLabel] [DeviceName] [Port]

sh create-garden-monitor-uno.sh Monitor1 monitor1 ttyUSB0
```

#### ESP12 WiFi Board
```
sh create-garden-monitor-esp.sh [DeviceLabel] [DeviceName] [Port]

sh create-garden-monitor-esp.sh Monitor1 monitor1 ttyUSB0
```

### Create irrigator device
Set up a GreenSense irrigator device including MQTT bridge and automatic updater.
Note: Ensure the device is connected

#### Arduino Nano
```
sh create-garden-irrigator-nano.sh [DeviceLabel] [DeviceName] [Port]

sh create-garden-irrigator-nano.sh Irrigator1 irrigator1 ttyUSB1
```

#### Arduino Uno
```
sh create-garden-irrigator-uno.sh [DeviceLabel] [DeviceName] [Port]

sh create-garden-irrigator-uno.sh Irrigator1 irrigator1 ttyUSB1
```

#### ESP12 WiFi Board
```
sh create-garden-irrigator-esp.sh [DeviceLabel] [DeviceName] [Port]

sh create-garden-irrigator-esp.sh Irrigator1 irrigator1 ttyUSB1
```

### View device updater service log
Display the log from the automatic updater service for a device.
```
sh view-updater-log.sh [DeviceName]

sh view-updater-log.sh monitor1

sh view-updater-log.sh irrigator1
```
Note: Press CTRL+C to exit back to terminal.

### View MQTT bridge service log
Display the log from the MQTT bridge service for a device.
```
sh view-mqtt-bridge-log.sh [DeviceName]

sh view-mqtt-bridge-log.sh monitor1

sh view-mqtt-bridge-log.sh irrigator1
```
Note: Press CTRL+C to exit back to terminal.

### Restart Garden Device
Restart MQTT bridge and updater services for a device.
```
sh restart-garden-device.sh [DeviceName]

sh restart-garden-device.sh monitor1

sh restart-garden-device.sh irrigator1
```

### Disable Garden Device
Disable the MQTT bridge and automatic updater for a device.
Note: This doesn't remove the device only temporarily disables it.
```
sh disable-garden-device.sh [DeviceName]

sh disable-garden-device.sh monitor1

sh disable-garden-device.sh irrigator1
```

### Remove Garden Device
Remove the MQTT bridge and automatic updater service files for a device.
Note: This disables and completely removes the device service files.
```
sh remove-garden-device.sh [DeviceName]

sh remove-garden-device.sh monitor1

sh remove-garden-device.sh irrigator1
```

### Remove All Garden Devices
Remove all services for all garden devices found.
```
sh remove-garden-devices.sh
```

## Mosquitto MQTT Broker
Set up mosquitto MQTT broker without setting up the entire GreenSense index:
```
wget -O - https://raw.githubusercontent.com/GreenSense/Index/master/scripts/docker/mosquitto/install-mosquitto-docker-service-from-github.sh | sh -s mqttUsername mqttPassword
```
Note: Change mqttUsername and mqttPassword to the desired MQTT username and password.

## Jenkins Continuous Integration
Set up jenkins continous integration server for GreenSense projects:

### No Attached USB Devices
For use when no USB devices are attached.
This is used for running GreenSense tests that aren't hardware related, or don't need hardware to be attached to the same machine, such as sanity tests.
```
wget -O - https://raw.githubusercontent.com/GreenSense/Index/master/scripts/docker/jenkins/install-jenkins-docker-service-from-github.sh | sh -s
```

### 2 Attached USB Devices
For use when 4 USB devices are attached.
This is used on the GreenSense test server with the following attached:
- A test monitor/irrigator (combined) device and corresponding test simulation device
```
wget -O - https://raw.githubusercontent.com/GreenSense/Index/master/scripts/docker/jenkins/install-jenkins-docker-service-2-from-github.sh | sh -s
```

### 4 Attached USB Devices
For use when 4 USB devices are attached.
This is used on the GreenSense test server with the following attached:
- A test monitor device and corresponding test simulation device
- A test irrigator device and corresponding test simulation device
```
wget -O - https://raw.githubusercontent.com/GreenSense/Index/master/scripts/docker/jenkins/install-jenkins-docker-service-4-from-github.sh | sh -s
```

## Mobile UI

### Install Linear MQTT Dashboard 
The Linear MQTT Dashboard application will be the user interface for the GreenSense projects.
- Go to the play store
- Search for "linear mqtt"
- Install the "Linear MQTT Dashboard" application.

### Install Termux
Termux is linux style terminal for mobile applications, and will be used to import the Linear MQTT Dashboard config file.
- Go to the play store
- Search for "termux"
- Install the "Termux" application.

### Import config.linear file
- Open Termux
- Install OpenSSH
```
pkg install -y openssh
```
- Import the config.linear file (automatically generated when creating garden devices using the steps above).
```
# Format:
scp [user]@[host]:~/workspace/GreenSense/Index/mobile/linearmqtt/output/config.linear config.linear
# Example:
scp j@garden:~/workspace/GreenSense/Index/mobile/linearmqtt/output/config.linear config.linear
```
- Open the config.linear file
```
termux-open config.linear
```
- The Linear MQTT Dashboard should open and ask if you want to import the configuration.
- Select YES
- The GreenSense user interface should now be displayed.
